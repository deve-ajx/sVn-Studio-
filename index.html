<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>sVn Tech Agency - Members</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{--dark:#0b0b0b;--accent:#38bdf8;--light:#e5e7eb;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
body{background:var(--dark);color:var(--light);overflow-x:hidden}

/* AUTH SCREEN */
#authScreen{
display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;
background:#000;position:fixed;width:100%;z-index:9999;
}
#authScreen input{
padding:12px;margin:10px;width:260px;border-radius:8px;border:1px solid var(--accent);
background:#111;color:#fff;
}
#authScreen button{
padding:12px 20px;margin:5px;border:none;border-radius:8px;background:var(--accent);
cursor:pointer;font-weight:bold;
}
#message{margin-top:10px;color:var(--accent)}
#checkVerificationBtn{
padding:10px 20px;margin-top:10px;background:#38bdf8;color:#000;border:none;border-radius:6px;cursor:pointer;
}

/* MAIN SITE */
#mainSite{display:none;padding:20px;}

/* USERNAME & PROFILE MODALS */
.modal{
display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);
justify-content:center;align-items:center;z-index:1000;
}
.modal-content{
background:#111;padding:30px;border-radius:12px;width:320px;text-align:center;
}
.modal-content input, .modal-content textarea{
width:100%;padding:10px;margin:10px 0;border-radius:6px;border:1px solid #38bdf8;background:#000;color:#fff;
}
.modal-content button{
padding:10px 20px;background:#38bdf8;color:#000;border:none;border-radius:6px;cursor:pointer;
}

/* HEADER */
header{
display:flex;justify-content:space-between;align-items:center;
padding:20px;background:rgba(15,15,15,.95);
border-bottom:1px solid #111;backdrop-filter:blur(10px)
}
.logo{width:60px;height:60px;border-radius:50%;padding:4px;border:2px solid var(--accent);transition:.6s}
.logo:hover{transform:rotate(360deg) scale(1.1)}
nav a{color:var(--light);margin-left:25px;text-decoration:none;font-weight:500;cursor:pointer}

/* MEMBERS PAGE */
#membersPage{margin-top:30px;}
.member-card{
background:#111;padding:15px;border-radius:12px;margin-bottom:15px;cursor:pointer;
display:flex;align-items:center;gap:15px;
}
.member-card img{width:50px;height:50px;border-radius:50%;object-fit:cover;}
.member-card span{font-weight:bold;font-size:1.1rem;}

/* PROFILE EDIT SECTION */
#editProfile{margin:20px 0;}
#editProfile img{width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:10px;}

/* COMMENTS */
#commentBox{margin-top:20px;}
.comment{background:#111;padding:15px;border-radius:12px;margin-bottom:10px;position:relative;}
.delete-btn{position:absolute;top:10px;right:10px;background:red;border:none;color:#fff;padding:4px 8px;border-radius:5px;cursor:pointer;}

footer{background:#020617;padding:30px;text-align:center;color:#9ca3af}
</style>
</head>

<body>

<!-- AUTH SCREEN -->
<div id="authScreen">
<h2>sVn Studio Members Access</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<div>
<button id="loginBtn">Login</button>
<button id="signupBtn">Sign Up</button>
</div>
<button id="checkVerificationBtn">I verified my email</button>
<p id="message"></p>
</div>

<!-- USERNAME MODAL -->
<div class="modal" id="usernameModal">
<div class="modal-content">
<h3>Pick a Username</h3>
<input type="text" id="newUsername" placeholder="Enter username">
<button id="saveUsername">Save</button>
</div>
</div>

<!-- PROFILE EDIT MODAL -->
<div class="modal" id="editProfileModal">
<div class="modal-content">
<h3>Edit Profile</h3>
<img id="profilePreview" src="" alt="Profile Picture">
<input type="file" id="profilePicInput">
<input type="text" id="profileUsername" placeholder="Username">
<textarea id="profileBio" placeholder="Bio"></textarea>
<button id="saveProfileBtn">Save Profile</button>
<button id="closeProfileBtn" style="background:red;margin-top:10px;">Close</button>
</div>
</div>

<!-- MEMBER PROFILE VIEW MODAL -->
<div class="modal" id="viewProfileModal">
<div class="modal-content">
<img id="viewProfilePic" src="" alt="Profile Picture" style="width:100px;height:100px;border-radius:50%;object-fit:cover;">
<h3 id="viewUsername"></h3>
<p id="viewBio"></p>
<button id="closeViewProfileBtn" style="background:red;margin-top:10px;">Close</button>
</div>
</div>

<!-- MAIN SITE -->
<div id="mainSite">
<header>
<img class="logo" src="https://res.cloudinary.com/dm6k0etap/image/upload/v1769549277/0919b84a-9700-465e-8827-3a4e24a11790_idxg1u.jpg">
<nav>
<a id="editProfileBtn">Edit Profile</a>
<a id="logoutBtn" style="color:red;">Logout</a>
</nav>
</header>

<div id="membersPage">
<h2>Members</h2>
<div id="membersList"></div>
</div>

<section id="commentsSection">
<h2>Members Only Comments</h2>
<textarea id="commentInput" rows="3" style="width:100%;border-radius:8px;padding:10px;background:#111;color:#fff;border:1px solid #38bdf8;"></textarea>
<button class="btn" id="postCommentBtn" style="margin-top:10px;">Post Comment</button>
<div id="commentBox"></div>
</section>

<footer>© 2026 sVn Studio Tech Agency — Modern • Clean • Powerful</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
apiKey: "AIzaSyD0CpkbFpoKPvB1akarURWyzwiwftOiq5g",
authDomain: "studio-1d6b7.firebaseapp.com",
projectId: "studio-1d6b7",
storageBucket: "studio-1d6b7.firebasestorage.app",
messagingSenderId: "808981598394",
appId: "1:808981598394:web:fe6789050b9a39e288f283"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const authScreen = document.getElementById("authScreen");
const mainSite = document.getElementById("mainSite");
const email = document.getElementById("email");
const password = document.getElementById("password");
const message = document.getElementById("message");
const loginBtn = document.getElementById("loginBtn");
const signupBtn = document.getElementById("signupBtn");
const logoutBtn = document.getElementById("logoutBtn");
const checkVerificationBtn = document.getElementById("checkVerificationBtn");

const usernameModal = document.getElementById("usernameModal");
const newUsername = document.getElementById("newUsername");
const saveUsername = document.getElementById("saveUsername");

const editProfileModal = document.getElementById("editProfileModal");
const editProfileBtn = document.getElementById("editProfileBtn");
const closeProfileBtn = document.getElementById("closeProfileBtn");
const profilePreview = document.getElementById("profilePreview");
const profilePicInput = document.getElementById("profilePicInput");
const profileUsername = document.getElementById("profileUsername");
const profileBio = document.getElementById("profileBio");
const saveProfileBtn = document.getElementById("saveProfileBtn");

const membersList = document.getElementById("membersList");
const viewProfileModal = document.getElementById("viewProfileModal");
const viewProfilePic = document.getElementById("viewProfilePic");
const viewUsername = document.getElementById("viewUsername");
const viewBio = document.getElementById("viewBio");
const closeViewProfileBtn = document.getElementById("closeViewProfileBtn");

const commentInput = document.getElementById("commentInput");
const postCommentBtn = document.getElementById("postCommentBtn");
const commentBox = document.getElementById("commentBox");

// --- AUTH ---
loginBtn.onclick = async () => {
  try {
    const userCred = await signInWithEmailAndPassword(auth,email.value,password.value);
    await userCred.user.reload();
    if(!userCred.user.emailVerified){
      message.innerText = "Verify your email before login!";
      return;
    }
  } catch(err){ message.innerText = err.message; }
};

signupBtn.onclick = async () => {
  try {
    const userCred = await createUserWithEmailAndPassword(auth,email.value,password.value);
    await sendEmailVerification(userCred.user);
    message.innerText="Account created! Check your email to verify.";
  } catch(err){ message.innerText = err.message; }
};

checkVerificationBtn.onclick = async () => {
  const user = auth.currentUser;
  if(user){
    await user.reload();
    if(user.emailVerified){
      message.innerText = "Email verified! Reloading site...";
    } else {
      message.innerText = "Email not verified yet!";
    }
  }
};

logoutBtn.onclick = async () => { await signOut(auth); }

// --- ON AUTH STATE ---
onAuthStateChanged(auth, async (user)=>{
  if(user && user.emailVerified){
    authScreen.style.display="none";
    mainSite.style.display="block";

    // Username modal
    const userDoc = await getDoc(doc(db,"users",user.uid));
    if(!userDoc.exists()){
      usernameModal.style.display="flex";
    } else {
      usernameModal.style.display="none";
      // preload profile
      const data = userDoc.data();
      profilePreview.src = data.photoURL || "https://via.placeholder.com/80";
      profileUsername.value = data.username || "";
      profileBio.value = data.bio || "";
    }

    // Load members
    loadMembers();
  } else {
    authScreen.style.display="flex";
    mainSite.style.display="none";
    usernameModal.style.display="none";
  }
});

// --- USERNAME ---
saveUsername.onclick = async () => {
  const name = newUsername.value.trim();
  if(!name) return alert("Enter a username!");
  const user = auth.currentUser;
  await setDoc(doc(db,"users",user.uid), { username:name });
  usernameModal.style.display="none";
};

// --- PROFILE EDIT ---
editProfileBtn.onclick = ()=>{ editProfileModal.style.display="flex"; }
closeProfileBtn.onclick = ()=>{ editProfileModal.style.display="none"; }

saveProfileBtn.onclick = async ()=>{
  const user = auth.currentUser;
  if(!user) return;
  let photoURL = profilePreview.src;
  if(profilePicInput.files[0]){
    const file = profilePicInput.files[0];
    const storageRef = ref(storage, `profile_pics/${user.uid}`);
    await uploadBytes(storageRef,file);
    photoURL = await getDownloadURL(storageRef);
  }
  await setDoc(doc(db,"users",user.uid),{
    username: profileUsername.value.trim(),
    bio: profileBio.value.trim(),
    photoURL
  }, { merge:true });
  profilePreview.src = photoURL;
  editProfileModal.style.display="none";
  loadMembers();
};

// --- MEMBERS LIST ---
async function loadMembers(){
  membersList.innerHTML="";
  const qSnap = await collection(db,"users");
  const snap = await getDocs(qSnap);
  snap.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement("div");
    div.classList.add("member-card");
    div.innerHTML = `<img src="${data.photoURL||'https://via.placeholder.com/50'}">
                     <span>${data.username||'Anonymous'}</span>`;
    div.onclick = ()=>{
      viewProfilePic.src = data.photoURL || 'https://via.placeholder.com/100';
      viewUsername.innerText = data.username || 'Anonymous';
      viewBio.innerText = data.bio || '';
      viewProfileModal.style.display="flex";
    };
    membersList.appendChild(div);
  });
}

// --- VIEW PROFILE MODAL ---
closeViewProfileBtn.onclick = ()=>{ viewProfileModal.style.display="none"; }

// --- COMMENTS ---
postCommentBtn.onclick = async ()=>{
  const text = commentInput.value.trim();
  if(!text) return;
  const user = auth.currentUser;
  if(!user) return;
  await addDoc(collection(db,"comments"), { uid:user.uid, text, timestamp:new Date() });
  commentInput.value="";
};

// Real-time comments
const commentsQuery = query(collection(db,"comments"), orderBy("timestamp","asc"));
onSnapshot(commentsQuery,(snapshot)=>{
  commentBox.innerHTML="";
  snapshot.forEach(async docSnap=>{
    const data = docSnap.data();
    const id = docSnap.id;
    let usernameDisplay = "Anonymous";
    try{
      const userDoc = await getDoc(doc(db,"users",data.uid));
      if(userDoc.exists()) usernameDisplay = userDoc.data().username;
    }catch(e){}
    const div = document.createElement("div");
    div.classList.add("comment");
    div.innerHTML = `<strong>${usernameDisplay}</strong>: ${data.text}`;
    if(auth.currentUser && auth.currentUser.uid===data.uid){
      const delBtn = document.createElement("button");
      delBtn.classList.add("delete-btn");
      delBtn.textContent="Delete";
      delBtn.onclick = async ()=>{ await deleteDoc(doc(db,"comments",id)); };
      div.appendChild(delBtn);
    }
    commentBox.appendChild(div);
  });
});
</script>

</body>
</html>